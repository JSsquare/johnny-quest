# Ask Johnny

Ask Johnny is a lightweight recommendations app that suggests restaurants and cafes from Johnny's curated list and public recommendations. It provides a chat-like interface powered by OpenAI for natural-language requests and uses Supabase for simple access control (passkeys / email registrations).

## Key user flows
- Client opens the site and (optionally) sees a passkey modal handled by `app/components/PassKeyModal.tsx`.
- Users can unlock the site with a passkey validated via `pages/api/verify-passkey.ts` or register an email via `pages/api/new-user.ts`.
- The main chat UI is implemented in `app/components/MainChatContainer.tsx` and the home page is `app/page.tsx`.
- Recommendations are generated by an OpenAI chat completion endpoint at `app/api/ask/route.ts` which streams responses back to the client.

## Table of contents
- Features
- Architecture & key files
- Technologies
- Environment variables
- Local development
- Deployment
- Useful scripts

## Features
- Chat-style ask-for-recommendations UI with streaming responses.
- Passkey / email gating for access (Supabase-backed).
- Curated recommendations embedded as prompts for the assistant.
- Responsive UI built with Chakra UI and Tailwind CSS.
- Small set of REST API endpoints for verification and user registration.

## Architecture & key files
- Frontend (Next.js / App Router)
  - Home / client entry: `app/page.tsx`
  - Global layout: `app/layout.tsx`
  - Main chat UI: `app/components/MainChatContainer.tsx`
  - Passkey modal: `app/components/PassKeyModal.tsx`
  - City pills and helper components: `app/components/CityPillMainButton.tsx`, `app/components/AboutJohnnyLinkButton.tsx`
  - Constants & prompts: `app/constants/promptConstants.ts`, `app/constants/commonConstants.ts`
- Backend / API
  - OpenAI streaming route (Edge runtime): `app/api/ask/route.ts`
    - Uses OpenAI via the official `openai` package and streams tokens to the client.
  - Supabase-backed endpoints (server-side)
    - `pages/api/verify-passkey.ts`
    - `pages/api/new-user.ts`
    - `pages/api/accessed-user.ts`
  - Supabase client helper: `utils/supabaseClient.ts`
  - API helpers & logger: `utils/apiHelpers.ts`, `utils/logger.ts`
- Services used by the client
  - Client-side API wrapper: `services/apiService.ts` (helpers include `verifyPasskey`, `createUser`, `createNewAccessedUser`)

## Technologies
- Next.js (App Router)
- React 18 + TypeScript
- Tailwind CSS
- Chakra UI
- Supabase (JS client)
- OpenAI API (official `openai` package)
- Vercel (recommended deployment)
- Dev tooling: ESLint, Prettier, TypeScript

## Environment variables
- `OPENAI_API_KEY` — required for `app/api/ask/route.ts`
- `NEXT_PUBLIC_SUPABASE_URL` — required by `utils/supabaseClient.ts` (client)
- `SUPABASE_SERVICE_ROLE_KEY` — required by `utils/supabaseClient.ts` (server)
- Optional: `NODE_ENV` (used in logic to skip inserts during development)

## Local development
1. Install dependencies:
```sh
npm install
```
2. Add environment variables (local `.env` or platform env):
- `OPENAI_API_KEY`
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`

3. Run dev server:
```sh
npm run dev
```
Open http://localhost:3000

## Scripts (from `package.json`)
- `npm run dev` — start development server
- `npm run build` — build for production
- `npm run start` — start production server
- `npm run lint` — run ESLint
- `npm run format` — run Prettier

## Notes & implementation details
- The OpenAI route uses Edge runtime and the official OpenAI client to stream token deltas to the browser; review `app/api/ask/route.ts` for the completion and streaming implementation.
- Passkey/email registration is intentionally simple: the site inserts into Supabase tables `init_users` and `accessed_users` (see `pages/api/new-user.ts` and `pages/api/accessed-user.ts`).
- Client-side API calls are wrapped in `services/apiService.ts`.

## Where to change prompts and curated data
- Curated recommendations and system instructions live in `app/constants/promptConstants.ts`. Update this file to change the assistant personality or the dataset the assistant references.

## Contributing
- Follow code style (Prettier + ESLint)
- Add components under `app/components/`
- Keep runtime-sensitive secrets out of source control; use environment variables.

## License
- This repository does not include a license file. Add one if you wish to publish or share the project publicly.

If you'd like, I can:
- Add a short architecture diagram to this README.
- Expand the "Contributing" section with local testing instructions.
